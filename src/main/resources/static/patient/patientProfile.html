<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Patient Profile</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(to right, #43cea2, #185a9d);
    color: white; 
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

/* Navbar */
nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(0,0,0,0.7);
    padding: 15px 40px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}
nav div:first-child {
    font-size: 1.6rem;
    font-weight: bold;
}
nav div a {
    color: white;
    margin-left: 20px;
    text-decoration: none;
    font-weight: 500;
    transition: 0.3s;
}
nav div a:hover { 
    color: #4ecdc4;
    text-decoration: underline;
}
nav div a.active { 
    color: #ffd700; 
    text-decoration: underline; 
}

/* Container */
.container {
    width: 90%;
    max-width: 950px;
    margin: 60px auto 40px auto;
    background: rgba(0,0,0,0.55);
    padding: 50px 60px;
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.5);
}
.container h1 { 
    margin-bottom: 30px; 
    font-size: 2.3rem; 
    text-align:center; 
    letter-spacing: 1px;
}
.container p { 
    margin: 12px 0; 
    font-size: 1.15rem; 
    line-height: 1.6;
}

/* Button */
button { 
    padding: 12px 26px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    background-color: #4ecdc4;
    color: white;
    font-size: 1.05rem;
    margin-top: 15px;
    transition: 0.3s;
}
button:hover { 
    background-color: #38b3a2;
    transform: translateY(-2px);
}

/* Appointments */
.appointment-list {
    margin-top: 50px;
}
.appointment-card {
    background: rgba(255,255,255,0.12); 
    padding: 18px; 
    border-radius: 12px;
    margin-bottom: 18px; 
    position: relative; 
    transition: 0.3s;
}
.appointment-card:hover { 
    background: rgba(255,255,255,0.22); 
    transform: scale(1.02); 
}
.appointment-card p { margin: 6px 0; }
.status-badge {
    position: absolute; 
    top: 15px; 
    right: 15px;
    padding: 7px 16px; 
    border-radius: 20px;
    font-size: 0.85rem; 
    font-weight: 600; 
    color: white;
}
.status-pending { background: #ff6b6b; }
.status-confirmed { background: #28c76f; }

/* Delete Button */
.delete-btn {
    display: block;
    margin-top: 12px;
    background-color: #ff6b6b;
    color: white;
    padding: 8px 20px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 0.95rem;
    transition: 0.3s;
}
.delete-btn:hover {
    background-color: #ff4757;
    transform: translateY(-2px);
}

/* Footer */
footer {
    margin-top: auto;
    background: rgba(0,0,0,0.6);
    padding: 15px;
    text-align: center;
    font-size: 0.9rem;
    color: #ffd700;
}

/* Responsive */
@media(max-width: 768px){
    nav { flex-direction: column; gap: 10px; }
    .container { width: 94%; padding: 30px; margin: 25px auto; }
    nav div a { margin: 0 10px; }
}
</style>
</head>
<body>

<!-- Navbar -->
<nav>
    <div>Patient Dashboard</div>
    <div>
        <a href="patientHome.html">Home</a>
        <a href="patientDoctorList.html">Doctor List</a>
        <a href="patientContact.html">Contact</a>
        <a href="patientAppoinment.html">Appointments</a>
        <a href="patientProfile.html" class="active">Profile</a>
        <a href="#" id="logoutLink">Logout</a>
    </div>
</nav>

<!-- Profile Section -->
<div class="container">
    <h1>Patient Details</h1>
    <p><strong>Name:</strong> <span id="patientName"></span></p>
    <p><strong>Email:</strong> <span id="patientEmail"></span></p>
    <p><strong>Contact Number:</strong> <span id="patientNumber"></span></p>
    <p><strong>Role:</strong> <span id="patientRole"></span></p>

    <button id="logoutBtn">Logout</button>

    <!-- Appointments Section -->
    <div class="appointment-list" id="appointmentList">
        <h2 style="text-align:center; margin-top:40px;">Your Appointments</h2>
    </div>
</div>

<!-- Footer -->
<footer>
    &copy; 2025 Hospital Management | All Rights Reserved
</footer>

<script>
// ===== Check Login =====
const user = JSON.parse(localStorage.getItem('user'));
const role = localStorage.getItem('role');

if (!user || role !== 'patient') {
    alert("Please login first!");
    window.location.href = 'patientLogin.html';
}

// ===== Display Patient Info =====
document.getElementById('patientName').innerText = user.fullname;
document.getElementById('patientEmail').innerText = user.email;
document.getElementById('patientNumber').innerText = user.number;
document.getElementById('patientRole').innerText = user.role;

// ===== Logout Function =====
function logout() {
    localStorage.clear();
    window.location.href = 'patientLogin.html';
}
document.getElementById('logoutLink').addEventListener('click', logout);
document.getElementById('logoutBtn').addEventListener('click', logout);

// ===== Fetch Appointments =====
async function getAppointments() {
    const listContainer = document.getElementById("appointmentList");

    try {
        const res = await fetch(`http://localhost:8080/appointment/patient/${user.id}`);
        const data = await res.json();
        listContainer.innerHTML = "<h2 style='text-align:center;'>Your Appointments</h2>";

        if (!data || data.length === 0) {
            listContainer.innerHTML += "<p style='text-align:center;'>No appointments found.</p>";
            return;
        }

        data.forEach(a => {
            const status = a.status || "Pending";
            const meetingTime = a.meetingTime ? a.meetingTime : "Not Scheduled Yet";
            const doctorName = a.doctor ? a.doctor.fullname : "Doctor";

            const card = document.createElement("div");
            card.classList.add("appointment-card");

            card.innerHTML = `
                <span class="status-badge ${status === 'Confirmed' ? 'status-confirmed' : 'status-pending'}">
                    ${status}
                </span>
                <p><strong>Appointment ID:</strong> ${a.id}</p>
                <p><strong>Date:</strong> ${a.appointmentDate}</p>
                <p><strong>Symptoms:</strong> ${a.symptoms}</p>
                <p><strong>Address:</strong> ${a.address}</p>
                <p><strong>Govt ID:</strong> ${a.govtId}</p>
                <p><strong>Meeting Time:</strong> ${meetingTime}</p>
                ${status === "Confirmed"
                    ? `<p style="margin-top:10px; background:#28c76f; color:white; padding:8px; border-radius:6px; text-align:center;">
                        ‚úÖ Confirmed by <strong>Dr. ${doctorName}</strong>
                      </p>` : ""}
                <button class="delete-btn" onclick="deleteAppointment(${a.id})">üóëÔ∏è Delete Appointment</button>
            `;
            listContainer.appendChild(card);
        });
    } catch (err) {
        console.error(err);
        listContainer.innerHTML = "<p style='text-align:center;'>Failed to load appointments.</p>";
    }
}

// ===== Delete Appointment =====
async function deleteAppointment(id) {
    if (confirm("Are you sure you want to delete this appointment?")) {
        try {
            const res = await fetch(`http://localhost:8080/appointment/delete/${id}`, {
                method: "DELETE"
            });
            if (res.ok) {
                alert("Appointment deleted successfully!");
                getAppointments(); // refresh the list
            } else {
                alert("Failed to delete appointment!");
            }
        } catch (err) {
            console.error("Error:", err);
            alert("Error deleting appointment!");
        }
    }
}

getAppointments();
</script>

</body>
</html>
